/*! jquery-mediaPlayer 2015-04-21 
author:Zed*/
!function(a){function b(a,b){this.$element=a,this.flip=b.flip||!1,this.mediaMap=b.data,this.init()}b.prototype={createDom:function(){var a='<div class="player"><div class="screen"><a href="javascript:;" class="screen-priv-btn"><</a><a href="javascript:;" class="screen-next-btn">></a><div class="screen-content" id="screen-block"></div><div class="thumbnail"><a href="javascript:;" class="thumbnail-priv-btn"></a><a href="javascript:;" class="thumbnail-next-btn"></a><ul class="thumbnail-list" id="samllPic"></ul></div></div>';this.$element.html(a)},getMediaType:function(a){var b="<img src='"+a.src+"' width='100%' height='100%'>",c='<div class="music-bg" style="line-height:'+this.screenHeight+"px;height: "+this.screenHeight+'px"></div><audio controls style="width: 100%;height: 100%"><source src="'+a.src+'" type="audio/mpeg">'+0/0+a.src+'" type="audio/ogg"><embed width="100%" src="'+a.src+'">Your browser does not support this audio format.</audio>',d='<video width="100%" height="100%" controls><source src="'+a.src+'" type="video/mp4"><source src="'+a.src+'" type="video/ogg"><source src="'+a.src+'" type="video/webm"><object data="'+a.src+'" width="100%"><embed src="'+a.src+'" width="100%"></object>你的浏览器不支持</video>';return"image"==a.type?b:"audio"==a.type?c:"video"==a.type?d:void 0},render:function(){function b(){var a=h/i;return 90>a?(i--,b()):a>120&&(i++,b()),i}this.createDom(),this.parentHeight=a(a(".player").parent()).css("height"),this.thumbnailHeight=.19*parseInt(this.parentHeight),this.screenHeight=parseInt(this.parentHeight)-this.thumbnailHeight;var c,d=this,e=null,f=0,g=0;a(".player").css({width:"100%",height:this.parentHeight});var h=parseInt(a(".player").css("width")),i=20;i=b(),a(".screen").css("height",this.screenHeight),a("#screen-block").css("height",this.screenHeight).on("mouseover",function(){clearTimeout(e),a(".screen").addClass("screen-btn-show")}).on("mouseout",function(){e=setTimeout(function(){a(".screen").removeClass("screen-btn-show")},1e3)}),this.flip&&a(".thumbnail").addClass("flip"),this.mediaMap(function(b){var j="";c=Math.ceil(b.length/i);for(var k=(h-10*(i-1))/i,l=0;l<b.length;l++)j+='<li><a href="javascript:;"><img src="'+b[l].thumbnail+'" alt="" width="'+k+'" height="'+d.thumbnailHeight+'"/></a>',"video"==b[l].type&&(j+="<div class='video-mask' style='height: "+d.thumbnailHeight+"px; line-height:"+d.thumbnailHeight+"px'><div class='btn-bg'></div></div>"),"audio"==b[l].type&&(j+="<div class='audio-mask'  style='height: "+d.thumbnailHeight+"px; line-height:"+d.thumbnailHeight+"px'></div>"),j+="</li>";a("#samllPic").append(j).css({width:(h/i+10*(i-1))*b.length,height:d.thumbnailHeight}),a(".thumbnail").on("mouseover",function(){a(this).addClass("btn-show")}).on("mouseout",function(){e=setTimeout(function(){a(this).removeClass("btn-show")},1e3)});var m=a("#samllPic li");d.seleced(m,f);for(var n=0;n<m.length;n++)a(m[n]).on("click",function(){var c=a(this).attr("index");f=c,d.toggle("#screen-block",m,b,f),a("#screen-block").html(d.getMediaType(b[f])),d.seleced(m,f)});d.toggle("#screen-block",m,b,f),a(".thumbnail-priv-btn").on("mouseover",function(){clearTimeout(e)}).on("mouseout",function(){a(".thumbnail").removeClass("btn-show")}).on("click",function(){return g--,0>g?void(g=0):void d.doMove("#samllPic",h,g)}),a(".thumbnail-next-btn").on("mouseover",function(){clearTimeout(e)}).on("mouseout",function(){a(".thumbnail").removeClass("btn-show")}).on("click",function(){return g++,g>c-1?void(g=c-1):void d.doMove("#samllPic",h,g)}),a(".screen-priv-btn").on("click",function(){if(f--,0>f&&(f=0),d.toggle("#screen-block",m,b,f),i*(g+1)-i>f){if(g--,0>g)return void(g=0);d.doMove("#samllPic",h,g)}}).on("mouseover",function(){clearTimeout(e)}).on("mouseout",function(){a(".screen").removeClass("screen-btn-show")}),a(".screen-next-btn").on("click",function(){if(f++,f>b.length-1&&(f=b.length-1),f>(g+1)*i-1){if(g++,g>c-1)return void(g=c-1);d.doMove("#samllPic",h,g)}d.toggle("#screen-block",m,b,f)}).on("mouseover",function(){clearTimeout(e)}).on("mouseout",function(){a(".screen").removeClass("screen-btn-show")})})},toggle:function(b,c,d,e){a(b).html(this.getMediaType(d[e])),this.seleced(c,e)},doMove:function(b,c,d){console.log(d);var e=d*c+10*(d+1);a(b).animate({left:-e})},seleced:function(b,c){for(var d=0;d<b.length;d++)a(b[d+1]).css({"padding-left":10}),a(b[d]).css("opacity",.4).attr("index",d),a(b[c]).css("opacity",1);return b},init:function(){this.render()}},a.fn.MediaPlayer=function(a){return new b(this,a)}}(window.jQuery);